{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "../partials/personDetails.njk" import personDetails %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% extends "../partials/layout.njk" %}

{% set pageHeading = "View Application" %}
{% set pageTitle = applicationName + " - " + pageHeading %}
{% set mainClasses = "app-container govuk-body" %}

{% block beforeContent %}
  {% if referrer %}
    {{ govukBackLink({
      text: "Back",
      href: referrer
    }) }}
  {% endif %}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-width-container">
      <div class="moj-page-header-actions">
        <div class="moj-page-header-actions__title">
          <h1 class="govuk-heading-xl">{{ pageHeading }}</h1>
        </div>
        <div class="moj-page-header-actions__actions">
          <div class="moj-button-menu">
            <div class="moj-button-menu__wrapper">
              {% if application.createdByUserId === user.id and application.assessmentDecision === 'accepted' %}
                <form action="{{paths.placementApplications.create({}) }}" method="post">
                  <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>
                  <input type="hidden" name="applicationId" value="{{ application.id }}"/>
                  {{ govukButton({
                    text: "Create placement request"
                  }) }}
                </form>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      {% if application.assessmentDecision %}
        {% set html %}
        <p class="govuk-body">Application was {{ application.assessmentDecision }} on {{ formatDate(application.assessmentDecisionDate) }}</p>
        <p class="govuk-body">
          <a href="{{paths.assessments.show({id: application.assessmentId})}}" data-cy-assessmentId="{{ application.assessmentId }}">View assessment</a>
        </p>
        {% endset %}

        {{ govukInsetText({
          html: html
        }) }}
      {% endif %}

      {{ personDetails(application.person) }}

      {% for section in SummaryListUtils.summaryListSections(application, false) %}
        <h2 class="govuk-heading-l">{{ section.title }}</h2>
        {% for task in section.tasks %}
          {{
            govukSummaryList(task)
          }}
        {% endfor %}
      {% endfor %}
    </div>
  </div>
{% endblock %}
